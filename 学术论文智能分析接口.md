# å››ã€ å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†ææ¥å£

## 1. æ¦‚è§ˆ 

- **API åç§°**: å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æAPI
- **æ¥å£çŠ¶æ€**: `[ç¨³å®š]`
- **æ¥å£æè¿°**: æä¾›åŸºäº MainScheduler çš„ç«¯åˆ°ç«¯å­¦æœ¯è®ºæ–‡å¤„ç†ç³»ç»Ÿã€‚å®ƒé›†æˆäº†PDFè§£æã€å…ƒæ•°æ®æå–ã€æ‘˜è¦è¯­æ­¥åˆ†æã€è®ºæ–‡è„‰ç»œåˆ†æä»¥åŠå›¾è¡¨æ˜ å°„ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›å…¨é¢ã€ç»“æ„åŒ–çš„è®ºæ–‡æ´å¯Ÿã€‚

### åŠŸèƒ½ç‰¹æ€§

- **PDFè§£æ**: è‡ªåŠ¨è§£æPDFæ–‡ä»¶ï¼Œæå–æ–‡æœ¬ã€å›¾è¡¨å’Œå…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€ä½œè€…ç­‰ï¼‰ã€‚
- **è„‰ç»œåˆ†æ**: æŒ‰ç…§å­¦æœ¯è®ºæ–‡ç»“æ„æå–äº”å¤§æ ¸å¿ƒè„‰ç»œå†…å®¹ã€‚
- **æ‘˜è¦æå–**: æ™ºèƒ½æå–æ‘˜è¦ä¸­çš„å››ä¸ªå…³é”®è¯­æ­¥ï¼ˆèƒŒæ™¯ã€æ–¹æ³•ã€åˆ›æ–°ç‚¹ã€å±€é™ï¼‰ã€‚
- **å›¾è¡¨æ˜ å°„**: å°†å›¾è¡¨æŒ‰æ‰€å±è„‰ç»œåˆ†ç±»å¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚
- **å¹¶è¡Œå¤„ç†**: å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚
- **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·çŠ¶æ€æ£€æŸ¥æ¥å£ï¼Œæ–¹ä¾¿ç›‘æ§ã€‚

## 2. æ ¸å¿ƒæ¥å£: /paper_vis

æ­¤æ¥å£æ˜¯ç³»ç»Ÿçš„ä¸»è¦å…¥å£ï¼Œæ¥æ”¶ä¸€ä¸ªPDFæ–‡ä»¶ï¼Œæ‰§è¡Œå®Œæ•´çš„åˆ†ææµç¨‹ï¼Œå¹¶è¿”å›ç»“æ„åŒ–çš„JSONç»“æœã€‚**<u>ï¼ˆå¯ç›´æ¥è¯»å–å®¢æˆ·ç«¯çš„æœ¬åœ°æ–‡ä»¶ï¼‰</u>**

### 2.1. è¯·æ±‚

- **Endpoint (ç«¯ç‚¹)**
  - `POST http://10.3.35.21:8004/paper_vis`
- **è¯·æ±‚å‚æ•°**
  - è¯·æ±‚ä½“ä¸º `multipart/form-data`ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å‚æ•°å | ç±»å‹ | æ˜¯å¦å¿…å¡« | æè¿°                    |
| ------ | ---- | -------- | ----------------------- |
| `file` | File | æ˜¯       | ç”¨æˆ·ä¸Šä¼ çš„å•ä¸ªPDFæ–‡ä»¶ã€‚ |

- **å¤‡ç”¨è¯·æ±‚æ–¹å¼**:
  - é™¤äº†ä¸Šä¼ æ–‡ä»¶ï¼Œæ¥å£ä¹Ÿæ”¯æŒé€šè¿‡JSONæŒ‡å®š**æœåŠ¡å™¨æœ¬åœ°**çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œåˆ†æã€‚
  - **Endpoint**: `POST http://10.3.35.21:8004/paper_vis`
  - **Headers**: `Content-Type: application/json`
  - **Body**: `{"pdf_path": "/path/on/server/to/paper.pdf"}`

### 2.2. å“åº” 

- **æˆåŠŸå“åº” **

  - **HTTP çŠ¶æ€ç **: `200 OK`

  - **å“åº”ä½“ (JSON ç¤ºä¾‹)**:

    ```shell
    {
      "success": true,
      "metadata": {
        "title": "HYPOSPACE: EVALUATING LLM CREATIVITY AS SET-VALUED HYPOTHESIS GENERATORS UNDER UNDERDETERMINATION",
        "authors": ["ä½œè€…1", "ä½œè€…2", "ä½œè€…3"]
      },
      "abstract": {
        "background_problem": "èƒŒæ™¯å’Œé—®é¢˜æè¿°",
        "method_approach": "æ–¹æ³•å’Œé€”å¾„",
        "Innovation": "åˆ›æ–°ç‚¹",
        "Limitation/Future Work": "å±€é™å’Œæœªæ¥å·¥ä½œ"
      },
      "lanes": {
        "Context & Related Work": "ç›¸å…³å·¥ä½œå’ŒèƒŒæ™¯å†…å®¹",
        "Methodology & Setup": "æ–¹æ³•è®ºå’Œè®¾ç½®å†…å®¹",
        "Results & Analysis": "ç»“æœå’Œåˆ†æå†…å®¹",
        "Conclusion": "ç»“è®ºå†…å®¹",
        "Innovation Discovery": "å­¦æœ¯åˆ›æ–°æœºä¼šå‘ç°"
      },
      "figure_map": {
        "Context & Related Work": [
          {
            "figure_id": "fig1",
            "caption": "å›¾è¡¨æ ‡é¢˜",
            "content": "ç›¸å…³æ–‡æœ¬å†…å®¹"
          }
        ],
        "Results & Analysis": [
          {
            "figure_id": "fig2",
            "caption": "ç»“æœå›¾è¡¨",
            "content": "ç»“æœç›¸å…³æ–‡æœ¬"
          }
        ]
      },
      "pdf_info": {
        "file_path": "/path/to/paper.pdf",
        "file_size": 1234567,
        "page_count": 10
      },
      "processing_info": {
        "steps_completed": ["pdf_parsing", "abstract_steps", "lane_extraction", "figure_mapping", "final_json_generation"],
        "total_time": 22.54,
        "success": true
      },
      "raw_data": {
        "md_content_length": 50000,
        "content_list_count": 150,
        "figure_dict_count": 8
      }
    
    ```

## 3. è¾…åŠ©æ¥å£

ç”¨äºç›‘æ§æœåŠ¡çš„å¥åº·å’Œè¿è¡ŒçŠ¶æ€ã€‚

### 3.1. GET /health

- **åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡æ˜¯å¦å¥åº·ï¼Œèƒ½å¦å“åº”è¯·æ±‚ã€‚

- **Endpoint**: `GET http://10.3.35.21:8004/health`

- **å“åº”**:

  ```shell
  {
    "status": "healthy",
    "timestamp": "2025-01-27T10:30:00Z"
  }
  ```

### 3.2. GET /status

- **åŠŸèƒ½**: è·å–æœåŠ¡çš„è¯¦ç»†çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚ç‰ˆæœ¬å·ã€è¿è¡Œæ—¶é•¿ã€‚

- **Endpoint**: `GET http://10.3.35.21:8004/status`

- **å“åº”**:

  ```shell
  {
    "status": "running",
    "uptime": 3600,
    "version": "1.0.0"
  }
  ```

## 4. è°ƒç”¨ç¤ºä¾‹

### 4.1. Python è¯·æ±‚

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
APIæµ‹è¯•å®¢æˆ·ç«¯
æµ‹è¯•æ–‡ä»¶ä¸Šä¼ æ¥å£ /paper_vis
"""

import requests
import json
import time
import os


def test_paper_vis_upload():
    """æµ‹è¯• /paper_vis æ–‡ä»¶ä¸Šä¼ æ¥å£"""
    
    # APIæœåŠ¡å™¨åœ°å€
    base_url = "http://10.3.35.21:8004"
    
    # æµ‹è¯•PDFæ–‡ä»¶è·¯å¾„
    test_pdf_path = "/Users/xiaokong/Desktop/2510.15614v1.pdf"
    
    print("ğŸ§ª æµ‹è¯• /paper_vis æ–‡ä»¶ä¸Šä¼ æ¥å£")
    print("=" * 60)
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not os.path.exists(test_pdf_path):
        print(f"âŒ æµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨: {test_pdf_path}")
        return
    
    print(f"ğŸ“„ ä¸Šä¼ æ–‡ä»¶: {test_pdf_path}")
    print("â³ å¼€å§‹åˆ†æ...")
    
    start_time = time.time()
    
    try:
        # å‡†å¤‡æ–‡ä»¶ä¸Šä¼ 
        with open(test_pdf_path, 'rb') as f:
            files = {
                'file': (os.path.basename(test_pdf_path), f, 'application/pdf')
            }
            
            response = requests.post(
                f"{base_url}/paper_vis",
                files=files,
                timeout=300  # 5åˆ†é’Ÿè¶…æ—¶
            )
        
        end_time = time.time()
        duration = end_time - start_time
        
        if response.status_code == 200:
            result = response.json()
            print("âœ… è®ºæ–‡åˆ†ææˆåŠŸ")
            print(f"â±ï¸ æ€»è€—æ—¶: {duration:.2f}ç§’")
            print(f"ğŸ“Š å¤„ç†ç»“æœ:")
            print(f"   - æˆåŠŸçŠ¶æ€: {result.get('success', False)}")
            print(f"   - å¤„ç†æ—¶é—´: {result.get('total_time', 0):.2f}ç§’")
            
            if result.get('success'):
                print(f"   - è®ºæ–‡æ ‡é¢˜: {result.get('metadata', {}).get('title', 'N/A')}")
                authors = result.get('metadata', {}).get('authors', [])
                print(f"   - ä½œè€…æ•°é‡: {len(authors) if authors else 0}")
                lanes = result.get('lanes', {})
                print(f"   - æ³³é“æ•°é‡: {len(lanes) if lanes else 0}")
                figure_map = result.get('figure_map', {})
                total_figures = sum(len(figures) for figures in figure_map.values()) if figure_map else 0
                print(f"   - å›¾è¡¨æ€»æ•°: {total_figures}")
                
                # ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
                output_file = "paper_vis_upload_result.json"
                with open(output_file, 'w', encoding='utf-8') as f:
                    json.dump(result, f, ensure_ascii=False, indent=2)
                print(f"ğŸ’¾ ç»“æœå·²ä¿å­˜åˆ°: {output_file}")
            else:
                print(f"âŒ åˆ†æå¤±è´¥: {result.get('error', 'æœªçŸ¥é”™è¯¯')}")
        else:
            print(f"âŒ è®ºæ–‡åˆ†æå¤±è´¥: {response.status_code}")
            print(f"   é”™è¯¯ä¿¡æ¯: {response.text}")
            
    except requests.exceptions.Timeout:
        print("âŒ è¯·æ±‚è¶…æ—¶ï¼ˆ5åˆ†é’Ÿï¼‰")
    except Exception as e:
        print(f"âŒ è®ºæ–‡åˆ†æå¼‚å¸¸: {e}")
    
    print("\n" + "=" * 60)
    print("ğŸ æµ‹è¯•å®Œæˆ")


def test_server_health():
    """æµ‹è¯•æœåŠ¡å™¨å¥åº·çŠ¶æ€"""
    base_url = "http://10.3.35.21:8004"
    
    try:
        # ç›´æ¥æµ‹è¯• /paper_vis æ¥å£çš„OPTIONSè¯·æ±‚
        response = requests.options(f"{base_url}/paper_vis", timeout=10)
        if response.status_code in [200, 405]:  # 405è¡¨ç¤ºæ–¹æ³•ä¸å…è®¸ï¼Œä½†æ¥å£å­˜åœ¨
            print("âœ… æœåŠ¡å™¨è¿è¡Œæ­£å¸¸")
            return True
        else:
            print(f"âŒ æœåŠ¡å™¨å“åº”å¼‚å¸¸: {response.status_code}")
            return False
    except Exception as e:
        print(f"âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨: {e}")
        return False


if __name__ == "__main__":
    print("ğŸš€ å¼€å§‹APIæµ‹è¯•")
    print("=" * 60)
    
    # é¦–å…ˆæµ‹è¯•æœåŠ¡å™¨å¥åº·çŠ¶æ€
    if test_server_health():
        print("\n" + "=" * 60)
        # æµ‹è¯•æ–‡ä»¶ä¸Šä¼ æ¥å£
        test_paper_vis_upload()
    else:
        print("âŒ æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¯·å…ˆå¯åŠ¨APIæœåŠ¡å™¨")
        print("   è¿è¡Œå‘½ä»¤: python api_server.py")
```

### 4.2. cURL ç¤ºä¾‹

```shell
# æ–¹å¼ä¸€ï¼šä¸Šä¼ æœ¬åœ°æ–‡ä»¶è¿›è¡Œåˆ†æ
curl -X POST "[http://10.3.35.21:8004/paper_vis](http://10.3.35.21:8004/paper_vis)" \
  -F "file=@/path/to/your/paper.pdf"

# æ–¹å¼äºŒï¼šåˆ†ææœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶
curl -X POST "[http://10.3.35.21:8004/paper_vis](http://10.3.35.21:8004/paper_vis)" \
  -H "Content-Type: application/json" \
  -d '{"pdf_path": "/path/on/server/to/paper.pdf"}'

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl -X GET "[http://10.3.35.21:8004/health](http://10.3.35.21:8004/health)"
```

### 4.3. JavaScript (Fetch API) ç¤ºä¾‹

```javascript
/**
 * è®ºæ–‡åˆ†æAPIå®¢æˆ·ç«¯
 */

// APIåŸºç¡€URL - ä½¿ç”¨ä»£ç†è·¯å¾„é¿å…CORSé—®é¢˜
const API_BASE_URL = process.env.NODE_ENV === 'development' ? '/api' : 'http://10.3.35.21:8004'

/**
 * ä¸Šä¼ PDFæ–‡ä»¶å¹¶è¿›è¡Œåˆ†æ
 * @param {File} pdfFile - PDFæ–‡ä»¶å¯¹è±¡
 * @param {Function} onProgress - è¿›åº¦å›è°ƒå‡½æ•°
 * @returns {Promise<Object>} åˆ†æç»“æœ
 */
export async function analyzePaper(pdfFile, onProgress = null) {
  try {
    console.log('ğŸš€ å¼€å§‹è®ºæ–‡åˆ†æ...')
    console.log('ğŸ“„ æ–‡ä»¶ä¿¡æ¯:', {
      name: pdfFile.name,
      size: pdfFile.size,
      type: pdfFile.type
    })

    // éªŒè¯æ–‡ä»¶ç±»å‹
    if (pdfFile.type !== 'application/pdf') {
      throw new Error('è¯·é€‰æ‹©PDFæ–‡ä»¶')
    }

    // åˆ›å»ºFormData
    const formData = new FormData()
    formData.append('file', pdfFile)

    // æ˜¾ç¤ºè¿›åº¦
    if (onProgress) {
      onProgress(10, 'å‡†å¤‡ä¸Šä¼ æ–‡ä»¶...')
    }

    const startTime = Date.now()

    // å‘é€è¯·æ±‚åˆ° /paper_vis æ¥å£
    const response = await fetch(`${API_BASE_URL}/paper_vis`, {
      method: 'POST',
      body: formData,
      mode: 'cors', // æ˜ç¡®æŒ‡å®šCORSæ¨¡å¼
      headers: {
        // ä¸è®¾ç½®Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®multipart/form-data
      },
      // æ³¨æ„ï¼šfetchä¸æ”¯æŒè¿›åº¦å›è°ƒï¼Œè¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿè¿›åº¦
    })

    const endTime = Date.now()
    const duration = (endTime - startTime) / 1000

    if (!response.ok) {
      throw new Error(`æœåŠ¡å™¨é”™è¯¯: ${response.status} ${response.statusText}`)
    }

    const result = await response.json()

    console.log('âœ… è®ºæ–‡åˆ†æå®Œæˆ')
    console.log('â±ï¸ æ€»è€—æ—¶:', duration.toFixed(2), 'ç§’')
    console.log('ğŸ“Š å¤„ç†ç»“æœ:', result)

    // éªŒè¯è¿”å›ç»“æœ
    if (!result.success) {
      throw new Error(result.error || 'åˆ†æå¤±è´¥')
    }

    // æ˜¾ç¤ºæœ€ç»ˆè¿›åº¦
    if (onProgress) {
      onProgress(100, 'åˆ†æå®Œæˆï¼')
    }

    return {
      success: true,
      data: result,
      duration: duration,
      metadata: {
        title: result.metadata?.title || 'æœªçŸ¥æ ‡é¢˜',
        authors: result.metadata?.authors || [],
        totalTime: result.total_time || duration,
        lanesCount: Object.keys(result.lanes || {}).length,
        figuresCount: Object.values(result.figure_map || {}).reduce((total, figures) => total + figures.length, 0)
      }
    }

  } catch (error) {
    console.error('âŒ è®ºæ–‡åˆ†æå¤±è´¥:', error)
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯CORSé”™è¯¯
    let errorMessage = error.message || 'æœªçŸ¥é”™è¯¯'
    if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
      errorMessage = 'è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡å™¨CORSé…ç½®æˆ–ä½¿ç”¨ä»£ç†'
    }
    
    // æ˜¾ç¤ºé”™è¯¯è¿›åº¦
    if (onProgress) {
      onProgress(0, `åˆ†æå¤±è´¥: ${errorMessage}`)
    }

    return {
      success: false,
      error: errorMessage,
      data: null
    }
  }
}

/**
 * æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€
 * @returns {Promise<boolean>} æœåŠ¡å™¨æ˜¯å¦å¯ç”¨
 */
export async function checkServerHealth() {
  try {
    const response = await fetch(`${API_BASE_URL}/paper_vis`, {
      method: 'OPTIONS',
      timeout: 10000
    })
    
    // 200æˆ–405éƒ½è¡¨ç¤ºæ¥å£å­˜åœ¨
    return response.status === 200 || response.status === 405
  } catch (error) {
    console.warn('æœåŠ¡å™¨å¥åº·æ£€æŸ¥å¤±è´¥:', error)
    return false
  }
}

/**
 * æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°ï¼ˆå› ä¸ºfetchä¸æ”¯æŒè¿›åº¦å›è°ƒï¼‰
 * @param {Function} onProgress - è¿›åº¦å›è°ƒå‡½æ•°
 * @param {number} duration - é¢„è®¡æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
 */
export function simulateProgress(onProgress) {
  let progress = 0
  const interval = setInterval(() => {
    progress += Math.random() * 10
    if (progress >= 90) {
      progress = 90
      clearInterval(interval)
    }
    
    const statuses = [
      'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...',
      'PDFè§£æä¸­...',
      'å†…å®¹æŠ½å–ä¸­...',
      'è¯­ä¹‰åˆ†æä¸­...',
      'ç”Ÿæˆç»“æœä¸­...'
    ]
    
    const statusIndex = Math.floor((progress / 100) * statuses.length)
    const status = statuses[Math.min(statusIndex, statuses.length - 1)]
    
    onProgress(Math.floor(progress), status)
  }, 1000)

  return interval
}

```

## 5. æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶è·¯å¾„**: ä½¿ç”¨JSONè¯·æ±‚æ—¶ï¼Œè¯·ç¡®ä¿ `pdf_path` æ˜¯æœåŠ¡å™¨å¯è®¿é—®çš„ç»å¯¹è·¯å¾„ã€‚
2. **å¤„ç†æ—¶é—´**: å¤§å‹æˆ–å¤æ‚çš„PDFè®ºæ–‡å¯èƒ½éœ€è¦è¾ƒé•¿çš„å¤„ç†æ—¶é—´ï¼Œå®¢æˆ·ç«¯åº”è®¾ç½®è¶³å¤Ÿé•¿çš„è¶…æ—¶æ—¶é—´ï¼ˆå»ºè®®2åˆ†é’Ÿä»¥ä¸Šï¼‰ã€‚
3. **æ–‡ä»¶æ ¼å¼**: ç›®å‰ä»…æ”¯æŒæ ‡å‡†çš„PDFæ ¼å¼æ–‡ä»¶ã€‚

## è¿ç»´ç¬”è®°

- **æ¥å£ç«¯å£**: `8004`

- **é…ç½®é¡¹åœ°å€**: `/etc/systemd/system/paper-vis-api.service`

- **ä»£ç ä½ç½®**: `/data/kongyb/paper_vis/paper_vis/api_server.py`

- **æ¥å£æºä»£ç **:

  ```python
  #!/usr/bin/env python3
  # -*- coding: utf-8 -*-
  """
  FastAPI æœåŠ¡å™¨ - å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†ææ¥å£
  åŸºäº MainScheduler çš„å®Œæ•´è®ºæ–‡å¤„ç†ç³»ç»Ÿ
  
  å”¯ä¸€æ¥å£ï¼š
  POST /paper_vis
  - è¾“å…¥ï¼šä¸Šä¼ PDFæ–‡ä»¶
  - è¾“å‡ºï¼šMainSchedulerçš„å®Œæ•´JSONç»“æœ
  """
  from fastapi.middleware.cors import CORSMiddleware
  from fastapi import FastAPI, HTTPException, UploadFile, File
  import uvicorn
  
  # å¯¼å…¥ä¸»è°ƒåº¦å™¨
  from MainScheduler import MainScheduler
  
  
  # åˆ›å»ºFastAPIåº”ç”¨
  app = FastAPI(
      title="å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æAPI",
      description="åŸºäºAIçš„å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æç³»ç»Ÿ",
      version="1.0.0"
  )
  
  origins = ["*"]
  
  # å°† CORS ä¸­é—´ä»¶æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­
  app.add_middleware(
      CORSMiddleware,
      allow_origins=origins,  # ä½¿ç”¨æ–°çš„ origins åˆ—è¡¨
      allow_credentials=True,
      allow_methods=["*"],
      allow_headers=["*"],
  )
  
  @app.post("/paper_vis")
  async def paper_vis(file: UploadFile = File(...)):
      """
      åˆ†æPDFè®ºæ–‡ - å”¯ä¸€æ¥å£
      
      è¾“å…¥ï¼š
      - file: ä¸Šä¼ çš„PDFæ–‡ä»¶
      
      è¾“å‡ºï¼š
      - MainSchedulerçš„å®Œæ•´JSONç»“æœ
      """
      try:
          print(f"ğŸš€ å¼€å§‹å¤„ç†PDFæ–‡ä»¶: {file.filename}")
          
          # æ£€æŸ¥æ–‡ä»¶ç±»å‹
          if not file.filename.lower().endswith('.pdf'):
              raise HTTPException(
                  status_code=400, 
                  detail="åªæ”¯æŒPDFæ–‡ä»¶æ ¼å¼"
              )
          
          # è¯»å–ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹
          file_content = await file.read()
          
          # åˆ›å»ºä¸»è°ƒåº¦å™¨å®ä¾‹
          scheduler = MainScheduler()
          
          # æ‰§è¡Œå®Œæ•´çš„è®ºæ–‡åˆ†ææµç¨‹ï¼ˆç›´æ¥ä½¿ç”¨æ–‡ä»¶å†…å®¹ï¼Œä¸ä¿å­˜åˆ°æœåŠ¡å™¨ï¼‰
          result = scheduler.process_uploaded_pdf(file_content, file.filename)
          
          return result
              
      except Exception as e:
          print(f"âŒ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: {e}")
          raise HTTPException(
              status_code=500,
              detail=f"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: {str(e)}"
          )
  
  
  if __name__ == "__main__":
      print("ğŸš€ å¯åŠ¨å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æAPIæœåŠ¡å™¨...")
      print("ğŸ“¡ æœåŠ¡åœ°å€: http://10.3.35.21:8004")
      print("ğŸ“Š å”¯ä¸€æ¥å£: POST /paper_vis")
      print("=" * 60)
      
      # å¯åŠ¨æœåŠ¡å™¨
      uvicorn.run(
          "api_server:app",
          host="0.0.0.0",
          port=8004,
          reload=True,
          log_level="info"
      )
  ```

  # äº”ã€ å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†ææœåŠ¡å¹³å° 

  ## 1. æ¦‚è§ˆ

  - **å¹³å°åç§°**: å­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†ææœåŠ¡å¹³å°
  - **å¹³å°çŠ¶æ€**: `[ç¨³å®š]`
  - **å¹³å°æè¿°**: æœ¬å¹³å°æ˜¯â€œå­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æAPIâ€çš„å¯è§†åŒ–å‰ç«¯ç•Œé¢ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„å›¾å½¢åŒ–æ“ä½œçª—å£ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼ PDFæ–‡ä»¶ï¼Œå¹¶ç›´è§‚åœ°æŸ¥çœ‹åˆ†æç»“æœã€‚

  ![50a3614bcb6612ad37ba3bce27bfd143](/Users/xiaokong/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_e0erez0j9yre22_7560/temp/RWTemp/2025-10/50a3614bcb6612ad37ba3bce27bfd143.png)

  ![7f5bea41e11b370867ebba38be801295](/Users/xiaokong/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_e0erez0j9yre22_7560/temp/RWTemp/2025-10/7f5bea41e11b370867ebba38be801295.png)

  ![338bb8e07c311fcc83a19cebbf1fbd44](/Users/xiaokong/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_e0erez0j9yre22_7560/temp/RWTemp/2025-10/338bb8e07c311fcc83a19cebbf1fbd44.png)

  ## 2. è®¿é—®åœ°å€

  - **å¹³å°è®¿é—®é“¾æ¥**:
    - `http://10.3.35.21:8080/upload`

  ## 3. æ³¨æ„äº‹é¡¹

  1. **æµè§ˆå™¨å…¼å®¹æ€§**: å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chrome, Firefox, æˆ– Edge æµè§ˆå™¨ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚
  2. **æ–‡ä»¶ä¸Šä¼ **: ç”¨æˆ·é€šè¿‡æ­¤å¹³å°ä¸Šä¼ çš„PDFæ–‡ä»¶ï¼Œå°†ç”±åç«¯â€œå­¦æœ¯è®ºæ–‡æ™ºèƒ½åˆ†æAPIâ€ (`http://10.3.35.21:8004`) è¿›è¡Œå¤„ç†ã€‚
  3. **ç½‘ç»œç¯å¢ƒ**: è¯·ç¡®ä¿å®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®æœåŠ¡å™¨ `10.3.35.21` çš„ `8080` ç«¯å£ã€‚

  ## è¿ç»´è®°å½•

  - **æœåŠ¡ç«¯å£**: `8080`

  - **WebæœåŠ¡å™¨é…ç½®**: `/etc/nginx/sites-enabled/paper-vis-frontend`

  - **é¡¹ç›®ä»£ç ä½ç½®**: `/data/kongyb/paper_vis/frontend/`

    

    